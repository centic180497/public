{"ast":null,"code":"const MAX_WEBSOCKET_FAILS = 7;\nconst MIN_WEBSOCKET_RETRY_TIME = 3000;\nconst MAX_WEBSOCKET_RETRY_TIME = 30000;\nexport default class WebsocketClient {// conn?: WebSocket\n  // connectionUrl: string\n  // token: string | null\n  // sequence: number\n  // connectionFailCount: number\n  // eventCallback?: Function\n  // firstConnectCallback?: Function\n  // reconnectCallback?: Function\n  // errorCallback?: Function\n  // closeCallback?: Function\n  // connectingCallback?: Function\n  // stop: boolean\n  // connectionTimeout: any\n  // constructor() {\n  //     this.connectionUrl = ''\n  //     this.token = null\n  //     this.sequence = 1\n  //     this.connectionFailCount = 0\n  //     this.stop = false\n  // }\n  // initialize(\n  //     connectionUrl = this.connectionUrl,\n  //     token: string | null,\n  //     opts?: any,\n  // ) {\n  //     return new Promise((resolve, reject) => {\n  //         if (this.conn) {\n  //             resolve()\n  //             return\n  //         }\n  //         if (this.connectionUrl === '') {\n  //             console.log(\n  //                 'ðŸ”¥ [Websocket]  Websocket must have connection url',\n  //             )\n  //             reject(new Error('Websocket must have connection url'))\n  //             return\n  //         }\n  //         this.conn = new WebSocket(connectionUrl)\n  //         this.connectionUrl = connectionUrl\n  //         this.token = token\n  //         this.conn!.onopen = () => {\n  //             if (token) {\n  //                 this.sendMessage('auth', { token })\n  //             }\n  //             if (this.connectionFailCount > 0) {\n  //                 console.log(\n  //                     'ðŸ”¥ [Websocket] Websocket re-established conneciton',\n  //                 )\n  //             } else if (this.firstConnectCallback) {\n  //                 this.firstConnectCallback()\n  //             }\n  //             this.connectionFailCount = 0\n  //             resolve()\n  //         }\n  //         this.conn!.onclose = () => {\n  //             this.conn = undefined\n  //             this.sequence = 1\n  //             if (this.connectionFailCount === 0) {\n  //                 console.log('ðŸ”¥ [Websocket] Websocket closed')\n  //             }\n  //             this.connectionFailCount++\n  //             if (this.closeCallback) {\n  //                 this.closeCallback(this.connectionFailCount)\n  //             }\n  //             let retryTime = MIN_WEBSOCKET_RETRY_TIME\n  //             if (this.connectionFailCount > MAX_WEBSOCKET_FAILS) {\n  //                 retryTime =\n  //                     MIN_WEBSOCKET_RETRY_TIME * this.connectionFailCount\n  //                 if (retryTime > MAX_WEBSOCKET_RETRY_TIME) {\n  //                     retryTime = MAX_WEBSOCKET_RETRY_TIME\n  //                 }\n  //             }\n  //             if (this.connectionTimeout) {\n  //                 clearTimeout(this.connectionTimeout)\n  //             }\n  //             this.connectionTimeout = setTimeout(() => {\n  //                 if (this.stop) {\n  //                     clearTimeout(this.connectionTimeout)\n  //                     return\n  //                 }\n  //                 this.initialize(this.connectionUrl, token)\n  //             }, retryTime)\n  //         }\n  //         this.conn!.onerror = (event) => {\n  //             if (this.connectionFailCount <= 1) {\n  //                 console.log('ðŸ”¥ [Websocket] Websocket error')\n  //                 console.log(event)\n  //             }\n  //             if (this.errorCallback) {\n  //                 this.errorCallback(event)\n  //             }\n  //         }\n  //         this.conn!.onmessage = (event) => {}\n  //     })\n  // }\n  // setConnectingCallback(callback: Function) {\n  //     this.connectingCallback = callback\n  // }\n  // setEventCallback(callback: Function) {\n  //     this.eventCallback = callback\n  // }\n  // setFirstConnectCallback(callback: Function) {\n  //     this.firstConnectCallback = callback\n  // }\n  // setReconnectCallback(callback: Function) {\n  //     this.reconnectCallback = callback\n  // }\n  // setErrorCallback(callback: Function) {\n  //     this.errorCallback = callback\n  // }\n  // setCloseCallback(callback: Function) {\n  //     this.closeCallback = callback\n  // }\n  // close(stop = false) {\n  //     this.stop = stop\n  //     this.connectionFailCount = 0\n  //     this.sequence = 1\n  //     if (this.conn && this.conn.readyState === WebSocket.OPEN) {\n  //         this.conn.onclose = () => {}\n  //         this.conn.close()\n  //         this.conn = undefined\n  //         console.log('ðŸ”¥ [Websocket] Websocket closed')\n  //     }\n  // }\n  // sendMessage(action: string, data: any) {}\n}","map":null,"metadata":{},"sourceType":"module"}